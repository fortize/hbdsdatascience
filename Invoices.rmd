---
title: "HbdsDataScience Invoices"
author: "Francisco Javier Ortiz Escuchas"
date: "18 de marzo de 2019"
output: 
  word_document: null
  html_document: default
  number_sections: yes
  theme: cosmo
  highlight: default
---

******
## Carga de librerias
******
Load libraries (ggplot2,data.table,corrplot,lubridate,dplyr,doParallel,ggmap)
```{r librerias, include=FALSE}
if(! "tm" %in% installed.packages()) 
  install.packages("tm",dependencies = TRUE)
library(tm)
if(! "pdftools" %in% installed.packages()) 
  install.packages("pdftools",dependencies = TRUE)
library(pdftools)
if(! "magrittr" %in% installed.packages()) 
  install.packages("magrittr",dependencies = TRUE)
library(magrittr)
if(! "dplyr" %in% installed.packages()) 
  install.packages("dplyr",dependencies = TRUE)
library(magrittr)
if(! "doParallel" %in% installed.packages()) 
  install.packages("doParallel",dependencies = TRUE)
library(doParallel)		# parallel processing

#Limpiamos el espacio de trabajo
rm(list = ls());
gc();
```

******
## Carga de datos
******
```{r descriptiva, echo=FALSE, message= FALSE}
# Cargamos los datos de los pdfs
mainDir <- "c:/tmp/hbdsdatascience/data/Invoices"

# Con la libreria DoParallel vamos a emplear el proceso en paralelo para los 
# procesadores de mi máquina (Windows 10) que vamos a detectar automáticamente
cl <- makeCluster(detectCores())
registerDoParallel(cl)

# Cargamos los ficheros del directorio especifico
files <- list.files(path = mainDir,pattern = "pdf$" ,all.files=TRUE,
    full.names=TRUE)
```

******
## Lectura pdfs
******
```{r descriptiva, echo=FALSE, message= FALSE}

# Creamos la tabla
corpus_raw <- data.frame("Client Ref." = c(),"importe" = c(), "Total" = c())

# Recorremos todos los ficheros
for (i in 1:length(files)){
 pdf_text(files[i]) %>% 
 strsplit("\n")-> document_text
data.frame("Client Ref." = gsub(x = files[i],pattern = ".pdf", replacement = ""),  "importe" = document_text, stringsAsFactors = FALSE, "Total" = 100) -> document
}

colnames(document) <- c("Client Ref.", "importe", "Total")
corpus_raw <- rbind(corpus_raw,document) 
```